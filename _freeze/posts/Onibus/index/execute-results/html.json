{
  "hash": "f832696c426741c847da242c088bcb80",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Monitoramento de Frota de Onibus\"\nauthor: \"Gerson Oliveira\"\ndate: \"2025-11-15\"\ncategories: [Monitoramento, code, analysis]\nimage: \"onibus.jpg\"\njupyter: python3\n---\n\nNeste post irei desmonstrar uma API para monitoramento de Linhas de onibus.\n\n::: {#66a7bcce .cell execution_count=1}\n``` {.python .cell-code}\nimport os\nimport requests\nfrom dotenv import load_dotenv\nimport folium\n\ndef main():\n    load_dotenv(\".env\")\n    token = os.getenv(\"SPTRANS_TOKEN\")\n    if not token:\n        raise ValueError(\"SPTRANS_TOKEN not found in .env. Please check your environment file.\")\n\n    \n    s = requests.Session()\n    r = s.post(f\"http://api.olhovivo.sptrans.com.br/v2.1/Login/Autenticar?token={token}\")\n    if r.text.lower() != \"true\":\n        raise RuntimeError(\"Authentication failed. Check your SPTRANS_TOKEN or API status.\")\n\n    \n    linha_busca = s.get(\"http://api.olhovivo.sptrans.com.br/v2.1/Linha/Buscar?termosBusca=607C-10\").json()\n\n    \n    if not linha_busca:\n        print(\"ATENÇÃO: A linha '607C-10' não foi encontrada na busca.\")\n        return \n\n    linha = linha_busca[0]\n    codigo = linha[\"cl\"]\n\n    \n    paradas = s.get(\n        f\"http://api.olhovivo.sptrans.com.br/v2.1/Parada/BuscarParadasPorLinha?codigoLinha={codigo}\"\n    ).json()\n\n    pos = s.get(\n        f\"http://api.olhovivo.sptrans.com.br/v2.1/Posicao/Linha?codigoLinha={codigo}\"\n    ).json()\n\n    \n    if paradas:\n        \n        print(f\"Linha {linha['lt']} ({linha['tl']}) encontrada. Gerando mapa...\")\n        \n        m = folium.Map(location=[paradas[0][\"py\"], paradas[0][\"px\"]], zoom_start=14)\n\n        \n        for p in paradas:\n            folium.Marker(\n                location=[p[\"py\"], p[\"px\"]],\n                popup=p[\"np\"],\n                icon=folium.Icon(color=\"blue\")\n            ).add_to(m)\n\n        \n        for v in pos.get(\"vs\", []):\n            folium.Marker(\n                location=[v[\"py\"], v[\"px\"]],\n                popup=f\"Ônibus {v['p']}\",\n                icon=folium.Icon(color=\"red\")\n            ).add_to(m)\n\n        m.save(\"mapa_linha_607C10.html\")\n        print(\"Mapa salvo com sucesso como 'mapa_linha_607C10.html'.\")\n    else:\n        \n        print(f\"ATENÇÃO: Não foi encontrada nenhuma parada para a linha com código {codigo}.\")\n\n\nif __name__ == \"__main__\":\n    main()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nATENÇÃO: Não foi encontrada nenhuma parada para a linha com código 1977.\n```\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}